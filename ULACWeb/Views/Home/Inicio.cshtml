@{
    ViewBag.Title = "Inicio";
    int IDEmpresa = (int)Session["IDEmpresa"];


}


<body>
    @section navbarUsuario{


    }
    @section carousel{
    }

    <!-- Contrato de Servicios -->
    <form id="formularioConfirmarServicio">

        <div class="container py-5">
            <h2 class="text-center mb-4">Selecciona tu servicio de transporte</h2>
            <div class="row justify-content-center">
                <!-- Opción 1: TenTons -->
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 name="Tentons" class="card-title text-center">Servicio TenTons</h5>
                            <p class="card-text">Transporta hasta 10 a 15 toneladas de mercancía.</p>
                            <p class="card-text">Marca de camión: Kenworth.</p>
                            <p class="card-text">No incluye seguro de carga.</p>
                            <p class="card-text">Costo: $2000</p>
                            <div class="form-check mb-3">
                                <input class="form-check-input" value="1" type="checkbox" id="tentonsCheckbox">
                                <label class="form-check-label" for="tentonsCheckbox">
                                    Seleccionar
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Opción 2: ULAC HeavyHaul -->
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 name="HeavyHaul" class="card-title text-center">Servicio HeavyHaul</h5>
                            <p class="card-text">Transporta hasta 30 a 40 toneladas de mercancía.</p>
                            <p class="card-text">Marca de camión: Freightliner.</p>
                            <p class="card-text">Incluye seguro de carga.</p>
                            <p class="card-text">Seguro de responsabilidad civil.</p>
                            <p class="card-text">Costo: $3500</p>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" value="2" id="heavyhaulCheckbox">
                                <label class="form-check-label" for="heavyhaulCheckbox">
                                    Seleccionar
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Opción 3: HeavyTruck -->
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 name="HeavyTruck" class="card-title text-center">Servicio HeavyTruck</h5>
                            <p class="card-text">Transporta hasta 40 a 60 toneladas de mercancía.</p>
                            <p class="card-text">Marcas de camión: International y Kenworth.</p>
                            <p class="card-text">Incluye seguro de carga.</p>
                            <p class="card-text">Servicio de atención al cliente las 24 horas.</p>
                            <p class="card-text">Documentación y trámites aduaneros</p>
                            <p class="card-text">Seguro de responsabilidad civil.</p>
                            <p class="card-text">Costo: $5000</p>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" value="3" id="heavytruckCheckbox">
                                <label class="form-check-label" for="heavytruckCheckbox">
                                    Seleccionar
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="container py-5">
                <h2 class="text-center mb-4">Confirmar Servicio de Transporte</h2>

                <!-- Campos de origen y destino -->

                <div class="search-form">

                    <div class="mb-3">
                        <label for="origenInput" class="form-label">Origen:</label>
                        <select class="form-select" id="origenInput" required>
                            <option value="">Selecciona el Origen</option>
                        </select>
                    </div>

                </div>

                <div class="mb-3">
                    <label for="destinoInput" class="form-label">Destino:</label>
                    <select class="form-select" id="destinoInput" required>
                        <option value="">Selecciona el destino</option>
                    </select>
                </div>

                <button class="btn btn-primary" id="botonCalcularTiempo">Calular Tiempo Estimado</button>
                <!-- Campo de tiempo estimado (se completará automáticamente) -->
                <div class="mb-3">
                    <label for="tiempoEstimado" class="form-label">Tiempo Estimado:</label>
                    <input type="text" class="form-control" id="tiempoEstimado" readonly>
                </div>

                <!-- Subtotal del servicio -->
                <div class="mb-3">
                    <label for="subtotal" class="form-label">Subtotal:</label>
                    <input type="text" class="form-control" id="subtotal" value="" readonly>
                </div>

                <!-- Total del servicio -->
                <div class="mb-3">
                    <label for="total" class="form-label">total:</label>
                    <input type="text" class="form-control" id="total" value="" readonly>
                </div>



                <!-- Método de pago -->
                <div class="mb-3">
                    <label for="metodoPago" class="form-label">Método de Pago:</label>
                    <select class="form-select" id="metodoPago" required>
                        <option value="">Seleccione un método de pago</option>
                        <option value="TarjetaCredito">Pago con tarjeta credito</option>
                        <option value="Transferencia">Pago por transferencia</option>
                    </select>
                </div>

                <!-- Detalles de Tarjeta de Crédito -->
                <div id="detallesTarjeta" style="display: none;" margin-bottom: 1rem;>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="Identificacion">Identificacion:</label>
                            <input type="text" class="form-control" name="Identificacion" id="Identificacion" placeholder="x-xxxx-xxxx">
                        </div>
                    <div>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="numeroTarjeta">Número de tarjeta:</label>
                                <input type="text" class="form-control" name="NumeroTarjeta" id="numeroTarjeta" placeholder="Ingrese el número de tarjeta">
                            </div>
                            <div class="col-md-3">
                                <label for="fechaVencimiento">Fecha de Vencimiento:</label>
                                <input type="text" class="form-control" name="FechaVencimiento" id="fechaVencimiento" placeholder="AAAA-MM-DD">
                            </div>
                            <div class="col-md-3">
                                <label for="codigoSeguridad">Código de Seguridad:</label>
                                <input type="text" class="form-control" name="CodigoSeguridad" id="codigoSeguridad" placeholder="Ingrese el código de seguridad">
                            </div>
                            <input type="hidden" name="idEmpresa" value="@Session["IDEmpresa"]" />
                        </div>
                    </div>
                <!-- Detalles de Transferencia -->
                    <div id="detallesTransferencia" style="display: none;">
                        <div class="mb-3">
                            <label for="Identificacion">Identificacion/Cédula:<span style="color: red;">*Este será su usuario*</span></label>
                            <input type="text" class="form-control" name="Identificacion" id="Identificacion" placeholder="x-xxxx-xxxx">
                        </div>
                        <div class="mb-3">
                            <label for="numeroCuenta">Número de cuenta:</label>
                            <input type="text" class="form-control" id="numeroCuenta" placeholder="Ingrese el número de cuenta bancaria">
                        </div>
                        <input type="hidden" name="idEmpresa" value="@Session["IDEmpresa"]" />
                    </div>
            </div>
            <!-- Botón de confirmar servicio -->
            <button type="submit" class="btn btn-primary" id="botonConfirmar">Confirmar Servicio</button>
        </div>
    </form>

    @section about{
    }
    @section fact{
    }
    @section service{
    }
    @section ubicacion{
    }
    @section testimonial{
    }
    @section footer{
    }


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>


    <!-- APIS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            $.ajax({
                url: '@Url.Action("ObtenerTipoCambio", "Inicio")',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    if(data.success) {
                        $("#tipoCambio").text("Tipo de cambio: ₡" + data.tipoCambio);
                    } else {
                        $("#tipoCambio").text("No se pudo obtener el tipo de cambio.");
                    }
                },
                error: function(xhr, status, error) {
                    $("#tipoCambio").text("No se pudo obtener el tipo de cambio.");
                }
            });
        });
    </script>


    <script>
        $(document).ready(function () {
            var username = "marilyn"; // Reemplaza con tu nombre de usuario de Geonames
            var apiUrl = "http://api.geonames.org/searchJSON";

            // Función para cargar ciudades en un elemento select
            function cargarCiudades(selectElement) {
                $.getJSON(apiUrl, {
                    country: 'CR,SV,GT,HN,NI,PA', // Códigos de países de Centroamérica
                    featureClass: 'P', // Solo ciudades
                    username: username // Tu nombre de usuario de Geonames
                }, function (data) {
                    // Limpiar el select
                    selectElement.find('option').remove();
                    // Agregar una opción predeterminada
                    selectElement.append($('<option>').text('Selecciona una ciudad').val(''));
                    // Agregar cada ciudad devuelta por la API al select
                    $.each(data.geonames, function (i, city) {
                        selectElement.append($('<option>').text(city.name).val(city.name));
                    });
                });
            }

            // Función para generar el tiempo estimado y mostrarlo en el campo correspondiente
            function generarTiempoEstimado() {
                // Generar un número aleatorio entre 1 y 10 para las horas
                var horas = Math.floor(Math.random() * 10) + 1;
                // Generar un número aleatorio entre 1 y 59 para los minutos
                var minutos = Math.floor(Math.random() * 59) + 1;
                // Concatenar los valores para formar el tiempo estimado
                var tiempoEstimado = horas + ' horas ' + minutos + ' minutos';
                // Devolver el tiempo estimado generado
                return tiempoEstimado;
            }

            // Manejar el clic en el botón para calcular el tiempo estimado y el total
            $('#botonCalcularTiempo').click(function () {
                // Generar el tiempo estimado
                var tiempoEstimado = generarTiempoEstimado();

                // Obtener el subtotal
                var subtotal = parseFloat($('#subtotal').val());

                // Calcular el total sumando el subtotal y un valor aleatorio entre 1000 y 2000
                var total = subtotal + Math.floor(Math.random() * (2000 - 1000 + 1) + 1000);

                // Mostrar el tiempo estimado en el campo correspondiente
                $('#tiempoEstimado').val(tiempoEstimado);
                // Mostrar el total en el campo correspondiente
                $('#total').val(total.toFixed(2));
            });

            $('.form-check-input').on('click', function () {
                // Inicializar el subtotal en 0
                var subtotal = 0;

                // Recorrer todas las casillas de verificación
                $('.form-check-input').each(function () {
                    // Si una casilla está marcada, sumar su valor al subtotal
                    if ($(this).is(':checked')) {
                        // Obtener el valor del checkbox
                        var valorCheckbox = parseFloat($(this).val());
                        // Asociar el valor del checkbox con el costo correspondiente
                        var costo;
                        if (valorCheckbox === 1) {
                            costo = 2000; // Costo para la opción 1
                        } else if (valorCheckbox === 2) {
                            costo = 3500; // Costo para la opción 2
                        } else if (valorCheckbox === 3) {
                            costo = 5000; // Costo para la opción 3
                        }
                        subtotal += costo;
                    }
                });

                // Mostrar el subtotal en el campo correspondiente
                $('#subtotal').val(subtotal.toFixed(2));
            });

            // Cargar ciudades en los select de origen y destino utilizando Places Autocomplete de Google
            cargarCiudades($('#origenInput, #destinoInput'));
        });
    </script>


    <script>
        // Función para mostrar u ocultar los detalles de la tarjeta de crédito según el método de pago seleccionado
        document.getElementById('metodoPago').addEventListener('change', function () {
            var detallesTarjeta = document.getElementById('detallesTarjeta');
            var detallesTransferencia = document.getElementById('detallesTransferencia');

            // Ocultar ambos inicialmente
            detallesTarjeta.style.display = 'none';
            detallesTransferencia.style.display = 'none';

            // Mostrar detalles según la selección
            if (this.value === 'TarjetaCredito') {
                detallesTarjeta.style.display = 'block';
            } else if (this.value === 'Transferencia') {
                detallesTransferencia.style.display = 'block';
            }
        });
    </script>

    <script>
    var idEmpresa = @Html.Raw(Json.Encode(Session["IDEmpresa"]));
    // Función para enviar el formulario
    function enviarFormulario() {
        // Obtener los valores de los campos del formulario
        var idEmpresa = @Html.Raw(Json.Encode(Session["IDEmpresa"]));
        var idTipoPaquete = obtenerIdTipoPaqueteSeleccionado();
        var Identificacion = $("#Identificacion").val();
        var origen = $("#origenInput").val();
        var destino = $("#destinoInput").val();
        var tiempoEstimado = $("#tiempoEstimado").val();
        var subtotal = parseFloat($("#subtotal").val());
        var metodoPago = $("#metodoPago").val();
        var total = parseFloat($("#total").val());

        // Variables para tarjeta y transferencia
        var numeroTarjeta = '', fechaVencimiento = '', codigoSeguridad = '';
        var nombreBanco = '', numeroCuenta = '', motivoTransferencia = '';

        // Chequear método de pago y asignar variables correspondientes
        if (metodoPago === 'TarjetaCredito') {
            numeroTarjeta = $("#numeroTarjeta").val();
            fechaVencimiento = $("#fechaVencimiento").val();
            codigoSeguridad = $("#codigoSeguridad").val();
        } else if (metodoPago === 'Transferencia') {
            nombreBanco = $("#nombreBanco").val();
            numeroCuenta = $("#numeroCuenta").val();
            motivoTransferencia = $("#motivoTransferencia").val();
        }

        // Crear un objeto con los datos del formulario
        var datosFormulario = {
            IDEmpresa: idEmpresa,
            IDTipoPaquete: idTipoPaquete,
            Identificacion: Identificacion,
            Origen: origen,
            Destino: destino,
            TiempoEstimado: tiempoEstimado,
         
            Subtotal: subtotal,
            MetodoPago: metodoPago,
            // Datos de tarjeta
            NumeroTarjeta: numeroTarjeta,
            FechaVencimiento: fechaVencimiento,
            CodigoSeguridad: codigoSeguridad,
            // Datos de transferencia
          
            NumeroCuenta: numeroCuenta,
            MotivoTransferencia: motivoTransferencia,
            Total: total
        };

        var urlAccion = '@Url.Action("ConfirmarServicio", "Inicio")';
       
        $.post(urlAccion, datosFormulario, function (respuesta) {
           
        });
    }
    </script>

</body>
